-- SCHEMA: Tourism_Management_System
-- DROP SCHEMA "Tourism_Management_System" ;
DROP SCHEMA Tourism_Management_System CASCADE;
CREATE SCHEMA Tourism_Management_System;
SET search_path TO Tourism_Management_System;

CREATE TABLE "User"(
UserID int PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
Fname VARCHAR(10) NOT NULL,
Lname VARCHAR(10) NOT NULL,
Email VARCHAR(20) NOT NULL,
Phone Numeric(10) NOT NULL,
IsActive BOOLEAN DEFAULT TRUE,
Gender CHAR(1) CHECK (GENDER IN('M','F','O')),
AGE int
);

CREATE TABLE COPASSENGER(
UID int NOT NULL REFERENCES "User"(UserID),
Fname VARCHAR(10) NOT NULL,
Lname VARCHAR(10) NOT NULL,
Email VARCHAR(20),
Phone DECIMAL(12,0),
Gender CHAR(1) CHECK (GENDER IN('M','F','O')),
AGE int,
PRIMARY KEY(UID,FNAME,LNAME)
);

CREATE TABLE BOOKING(
BID int GENERATED ALWAYS AS IDENTITY UNIQUE,
UserID int REFERENCES "User"(UserID) NOT NULL,
Booking_Date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
TripStart_Date Date NOT NULL,
TripEnd_Date Date NOT NULL,
Amount float,
PRIMARY KEY(BID, UserID)
);

CREATE TABLE BOOKING_COPASSENGER(
BID int NOT NULL REFERENCES BOOKING(BID),
UserID int NOT NULL,
Fname VARCHAR(10) NOT NULL,
Lname VARCHAR(10) NOT NULL,
FOREIGN KEY(BID,UserID) REFERENCES Booking(BID,UserID),
FOREIGN KEY(UserID,Fname,Lname) REFERENCES COPASSENGER(UID,FNAME,LNAME) ,
PRIMARY KEY(BID,UserID,Fname,Lname)
);

CREATE TABLE PACKAGE(
PACKAGEID int PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
TITLE VARCHAR(15) NOT NULL,
DURATION int,
NO_OF_PEOPLE int,
IsActive BOOLEAN DEFAULT TRUE,
AMOUNT float
);

CREATE TABLE BOOKING_FOR_PACKAGE(
BID int NOT NULL REFERENCES BOOKING(BID),
PACKAGEID int NOT NULL REFERENCES PACKAGE(PACKAGEID),
PRIMARY KEY(BID,PACKAGEID)
);

CREATE TABLE LOCATION(
PINCODE Numeric(6) PRIMARY KEY,
CITY VARCHAR(30),
"state" VARCHAR(30)
);

CREATE TABLE TOURIST_SPOTS(
SPOTID int PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
"Name" VARCHAR(20) NOT NULL,
SEASON VARCHAR(10),
RATINGS FLOAT CHECK (RATINGS>=0 AND RATINGS<=5),
ADDRESS VARCHAR(100),
PINCODE Numeric(6) REFERENCES LOCATION(PINCODE)
);

CREATE TABLE Package_Includes_Spots(
PACKAGEID int NOT NULL REFERENCES PACKAGE(PACKAGEID),
SPOTID int NOT NULL REFERENCES TOURIST_SPOTS(SPOTID) ON UPDATE CASCADE ON DELETE
CASCADE,
PRIMARY KEY(PACKAGEID,SPOTID)
);

CREATE TABLE GUIDE(
GUIDEID int PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
Fname VARCHAR(10) NOT NULL,
Lname VARCHAR(10) NOT NULL,
Email VARCHAR(20),
Phone Numeric(10) NOT NULL,
Gender CHAR(1) CHECK (GENDER IN('M','F','O')),
AGE int,
ADDRESS VARCHAR(100),
PINCODE Numeric(6) REFERENCES LOCATION(PINCODE)
);

CREATE TABLE Package_Includes_Guides(
PACKAGEID int NOT NULL REFERENCES PACKAGE(PACKAGEID),
GUIDEID int NOT NULL REFERENCES GUIDE(GUIDEID) ON DELETE CASCADE,
PRIMARY KEY(PACKAGEID,GUIDEID)
);

CREATE TABLE RESTAURANT(
RID int PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
"Name" VARCHAR(50) NOT NULL,
PHONE Numeric(10),
FOODTYPE VARCHAR(20) CHECK (FOODTYPE IN('VEG','NON-VEG','BOTH')),
RATINGS float CHECK (RATINGS>=0 AND RATINGS<=5),
ADDRESS VARCHAR(100),
PINCODE Numeric(6) REFERENCES LOCATION(PINCODE)
);

CREATE TABLE RESTAURANT_CUISINES(
RID int NOT NULL REFERENCES RESTAURANT(RID) ON DELETE CASCADE,
CUISINES VARCHAR(20) NOT NULL,
PRIMARY KEY(RID,CUISINES)
);

CREATE TABLE HOTEL(
HOTELID int PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
"Name" VARCHAR(50) NOT NULL,
PHONE Numeric(10),
FOODTYPE VARCHAR(20) CHECK (FOODTYPE IN('VEG','NON-VEG','BOTH')),
RATINGS float CHECK (RATINGS>=0 AND RATINGS<=5),
ADDRESS VARCHAR(100),
IsActive BOOLEAN DEFAULT TRUE,
PINCODE Numeric(6) REFERENCES LOCATION(PINCODE)
);

CREATE TABLE HOTEL_SERVICES(
HOTELID int NOT NULL REFERENCES HOTEL(HOTELID),
SERVICES VARCHAR(50) NOT NULL,
PRIMARY KEY(HOTELID,SERVICES)
);

CREATE TABLE ROOM(
HOTELID int NOT NULL REFERENCES HOTEL(HOTELID),
ROOM_NO DECIMAL(3,0) NOT NULL,
PRIMARY KEY(HOTELID,ROOM_NO),
"Type" VARCHAR(6) CHECK( "Type" IN('AC','NON-AC','HEATER')),
BEDS int CHECK(BEDS>0),
CAPACITY int CHECK(CAPACITY>0),
RATE FLOAT,
STATUS VARCHAR(15) CHECK (STATUS IN('AVAILABLE','NOT-AVAILABLE','BOOKED'))
);

CREATE TABLE ROOM_FACILITIES(
HOTELID int NOT NULL,
ROOMNO int NOT NULL,
FACILITY VARCHAR(50) NOT NULL,
FOREIGN KEY (HOTELID,ROOMNO) REFERENCES ROOM(HOTELID,ROOM_NO),
PRIMARY KEY(HOTELID,ROOMNO,FACILITY)
);

CREATE TABLE Package_Includes_Hotels(
PACKAGEID int NOT NULL REFERENCES PACKAGE(PACKAGEID) ,
HOTELID int NOT NULL,
ROOMNO int NOT NULL,
FOREIGN KEY (HOTELID,ROOMNO) REFERENCES ROOM(HOTELID,ROOM_NO),
PRIMARY KEY(PACKAGEID,HOTELID,ROOMNO)
);

CREATE TABLE Booking_For_Hotel(
BID int REFERENCES BOOKING(BID) NOT NULL,
HOTELID int NOT NULL,
ROOMNO int NOT NULL,
FOREIGN KEY (HOTELID,ROOMNO) REFERENCES ROOM(HOTELID,ROOM_NO),
PRIMARY KEY(BID,HOTELID,ROOMNO)
);